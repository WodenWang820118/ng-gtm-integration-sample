import{m as v}from"./chunk-C2HNWMJH.js";import{d as p,i as m}from"./chunk-XHDSLAJA.js";import{I as u,V as h,g as l,p as o}from"./chunk-YEGXVBAB.js";import{a as n,b as d}from"./chunk-OGBJ4DTI.js";var S=(()=>{let s=class s{constructor(t){this.analyticsService=t,this._orders=new l([]),this._totalPrice=this.calculateTotalPrice(),this.loadInitialData()}get orders$(){return this._orders.asObservable()}get totalPrice$(){return this._totalPrice}addToCart(t,r){t.pipe(u(1),o(e=>this.createOrder(e,r)),h(e=>{let i=this._orders.value,c=i.findIndex(O=>O.id===e.id);c!==-1?i[c]=this.updateOrderQuantity(i[c],e.quantity):i.push(e),this._orders.next(i),this.storeOrders(i),this.analyticsService.trackEvent("add_to_cart",[e])})).subscribe()}removeFromCart(t){let e=this._orders.value.filter(i=>i.id!==t.id);this._orders.next(e),this.analyticsService.trackEvent("remove_from_cart",[t]),this.storeOrders(e)}beginCheckout(){this.analyticsService.trackEvent("begin_checkout",this._orders.value)}calculateTotalPrice(){return this.orders$.pipe(o(t=>t.reduce((r,e)=>r+e.value*e.quantity,0)))}resetOrders(){this._orders.next([]),this.storeOrders([])}loadInitialData(){let t=JSON.parse(localStorage.getItem("orders")||"[]");this._orders.next(t)}storeOrders(t){localStorage.setItem("orders",JSON.stringify(t)),this.analyticsService.setCheckoutOrders(t)}createOrder(t,r){return{id:t.id,title:t.title,category:t.title,value:t.price,quantity:r,date:new Date,image:t.image1,currency:"USD"}}updateOrderQuantity(t,r){return d(n({},t),{quantity:r})}};s.\u0275fac=function(r){return new(r||s)(m(v))},s.\u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();export{S as a};
