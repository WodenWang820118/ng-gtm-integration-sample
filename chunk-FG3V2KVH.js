import{a,b as v}from"./chunk-HQ27U6FS.js";import{a as i,b as c}from"./chunk-WRNOLYUH.js";import"./chunk-XHDSLAJA.js";import{I as r,V as n,k as t}from"./chunk-YEGXVBAB.js";import{a as s}from"./chunk-OGBJ4DTI.js";var o=class extends a{constructor(){super("ng-gtm-integration"),this.version(3).stores({events:"++id, eventName"}),this.envDetectorService=new i,this.javascriptInterfaceService=new c(this.envDetectorService)}getEvents(){return v(()=>(console.log("Getting events from IndexedDB"),this.events.toArray()))}clearEvents(){return t(this.events.clear())}syncDataLayerEvents(){return t(this.getEvents()).pipe(r(1),n(m=>{m.forEach(e=>{!e.eventName||!e.eventData||(console.log("Syncing ecommerce from IndexedDB",e),window.dataLayer.push({ecommerce:null}),window.dataLayer.push(s({event:e.eventName},e.eventData)),this.javascriptInterfaceService.logEvent(e.eventName,e.eventData))}),this.clearEvents().pipe(r(1),n(()=>{console.log("Events cleared from IndexedDB")})).subscribe()}))}},u=new o;export{o as DataLayerDatabase,u as db};
